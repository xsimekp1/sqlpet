[build]
builder = "nixpacks"
buildCommand = "cd apps/api && pip install -r requirements.txt"

[deploy]
startCommand = "cd apps/api && uvicorn src.app.main:app --host 0.0.0.0 --port $PORT"
releaseCommand = "cd apps/api && python -c \"import os; from sqlalchemy import create_engine; print('DB URL:', os.getenv('DATABASE_URL', 'NOT SET')[:50] if os.getenv('DATABASE_URL') else 'NOT SET'); from alembic.config import Config; from alembic import command; cfg = Config('alembic.ini'); command.upgrade(cfg, 'head')\""
